#!/bin/bash

# Get user variables
echo "Enter the IP Address of the collector: "
read collip

echo "Enter the subnet bit count (e.g. enter 24 for a /24 network): "
read collprefix

echo "Enter the gateway of the collector: "
read collgw

echo "Enter the hostname of the collector: "
read collhostname

# Properly configure DNS & NTP

hostname $collhostname
printf "$collhostname.localdomain" > /etc/hostname

# Install the tools and utilities required by the collector
yum -y update
yum -y install wget bind-utils nano nmap perl net-tools traceroute openssh-server openssh-clients ntp net-snmp net-snmp-utils

# Enable the SSH service to turn on at boot
chkconfig sshd on
service sshd start

# Enable the SNMP service to turn on at boot. Set the community string
chkconfig snmpd on
printf "rocommunity public" > /etc/snmp/snmp.conf

# Create the bonded NIC using NIC 2 & 3
printf "DEVICE=bond0\nNAME=bond0\nTYPE=Bond\nBONDING_MASTER=yes\nIPADDR=$collip\nPREFIX=$collprefix\nGATEWAY\nONBOOT=yes\nBOOTPROTO=none\nBONDING_OPTS='mode=0 miimon=100'\n" > /etc/sysconfig/network-scripts/ifcfg-bond0

# Modify the existing NICs to act as slaves for the bond
printf "MASTER=bond0\nSLAVE=yes\n" >> /etc/sysconfig/network-scripts/ifcfg-enp0s20f2
printf "MASTER=bond0\nSLAVE=yes\n" >> /etc/sysconfig/network-scripts/ifcfg-enp0s20f3
sed -i "s/BOOTPROTO.*/BOOTPROTO=none/g" /etc/sysconfig/network-scripts/ifcfg-enp0s20f2
sed -i "s/BOOTPROTO.*/BOOTPROTO=none/g" /etc/sysconfig/network-scripts/ifcfg-enp0s20f3
sed -i "s/ONBOOT.*/ONBOOT=yes/g" /etc/sysconfig/network-scripts/ifcfg-enp0s20f2
sed -i "s/ONBOOT.*/ONBOOT=yes/g" /etc/sysconfig/network-scripts/ifcfg-enp0s20f3

# Set a static IP for HN Management
sed -i "s/BOOTPROTO.*/BOOTPROTO=none/g" /etc/sysconfig/network-scripts/ifcfg-enp0s20f1
sed -i "s/ONBOOT.*/ONBOOT=yes/g" /etc/sysconfig/network-scripts/ifcfg-enp0s20f1
printf "IPADDR=192.168.10.10\nPREFIX=24\n" >> /etc/sysconfig/network-scripts/ifcfg-enp0s20f1

# Restart networking to reflect the changes
service network restart
